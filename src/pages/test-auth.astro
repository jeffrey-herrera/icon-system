---
export const prerender = false;
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Auth Test - Braze Icon System</title>
    <script src="https://cdn.tailwindcss.com"></script>
  </head>
  <body class="min-h-screen bg-gray-50 flex items-center justify-center">
    <div class="max-w-md w-full space-y-8 p-8">
      <div class="text-center">
        <h2 class="text-2xl font-bold text-gray-900 mb-4">
          OAuth Configuration Test
        </h2>
        
        <div class="space-y-4">
          <div class="p-4 bg-blue-50 rounded-lg">
            <h3 class="font-semibold text-blue-900">Environment Check</h3>
            <div class="text-sm text-blue-800 mt-2">
              <p>Google Client ID: <span id="client-id">Loading...</span></p>
              <p>Auth URL: <span id="auth-url">Loading...</span></p>
            </div>
          </div>
          
          <button 
            id="test-google"
            class="w-full py-2 px-4 bg-red-600 text-white rounded-md hover:bg-red-700"
          >
            Test Google OAuth
          </button>
          
          <button 
            id="check-session"
            class="w-full py-2 px-4 bg-blue-600 text-white rounded-md hover:bg-blue-700"
          >
            Check Current Session
          </button>
          
          <div id="result" class="p-4 bg-gray-100 rounded-lg hidden">
            <h4 class="font-semibold">Result:</h4>
            <pre id="result-content" class="text-xs mt-2 whitespace-pre-wrap"></pre>
          </div>
        </div>
        
        <div class="mt-6">
          <a href="/login" class="text-blue-600 hover:text-blue-800">‚Üê Back to Login</a>
        </div>
      </div>
    </div>

    <script>
      // Show environment variables (client-side safe ones)
      document.getElementById('client-id').textContent = 
        import.meta.env.PUBLIC_GOOGLE_CLIENT_ID || 'Not set';
      document.getElementById('auth-url').textContent = 
        import.meta.env.PUBLIC_BETTER_AUTH_URL || 'Not set';

      // Test Google OAuth
      document.getElementById('test-google').addEventListener('click', async () => {
        try {
          const { authClient } = await import('../lib/auth-client');
          await authClient.signIn.social({
            provider: "google",
            callbackURL: "/test-auth",
          });
        } catch (error) {
          showResult('OAuth Error: ' + error.message);
        }
      });

      // Check session
      document.getElementById('check-session').addEventListener('click', async () => {
        try {
          const { authClient } = await import('../lib/auth-client');
          const session = await authClient.getSession();
          showResult('Session: ' + JSON.stringify(session, null, 2));
        } catch (error) {
          showResult('Session Error: ' + error.message);
        }
      });

      function showResult(content) {
        const resultDiv = document.getElementById('result');
        const resultContent = document.getElementById('result-content');
        resultContent.textContent = content;
        resultDiv.classList.remove('hidden');
      }
    </script>
  </body>
</html> 